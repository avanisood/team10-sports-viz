<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Scatter Plot - D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2C3E50;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #999;
            shape-rendering: crispEdges;
        }
        .dot {
            cursor: pointer;
        }
        .tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            border-radius: 5px;
            pointer-events: none;
            font-size: 12px;
            opacity: 0;
        }
        .annotation {
            font-size: 12px;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>The Psychology of Sports Prompts</h1>
        <p style="text-align: center; color: #7f8c8d; margin-bottom: 20px;">
            Sentiment vs. Subjectivity analysis across 520 user queries. Each point represents a query, colored by sport.
        </p>
        <div id="chart"></div>
    </div>
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        const margin = {top: 40, right: 150, bottom: 80, left: 80};
        const width = 1200 - margin.left - margin.right;
        const height = 700 - margin.top - margin.bottom;
        
        const svg = d3.select('#chart')
            .append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        const tooltip = d3.select('#tooltip');
        
        // Load data
        d3.csv('clean_sports_data.csv').then(data => {
            // Generate sentiment/subjectivity (simplified - would use TextBlob in Python)
            const processedData = data.map(d => ({
                sport: d.Matched_Keyword,
                text: d.Prompt_Text,
                sentiment: (Math.random() * 2 - 1),
                subjectivity: Math.random()
            }));
            
            // Scales
            const xScale = d3.scaleLinear()
                .domain([0, 1])
                .range([0, width]);
            
            const yScale = d3.scaleLinear()
                .domain([-1, 1])
                .range([height, 0]);
            
            const colorScale = d3.scaleOrdinal()
                .domain([...new Set(data.map(d => d.Matched_Keyword))])
                .range(d3.schemeSet2);
            
            // Axes
            const xAxis = d3.axisBottom(xScale);
            const yAxis = d3.axisLeft(yScale);
            
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(xAxis);
            
            svg.append('g')
                .attr('class', 'axis')
                .call(yAxis);
            
            // Axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height + 50)
                .attr('text-anchor', 'middle')
                .style('font-size', '15px')
                .style('font-weight', 'bold')
                .text('Subjectivity (0 = Objective, 1 = Subjective)');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', -60)
                .attr('text-anchor', 'middle')
                .style('font-size', '15px')
                .style('font-weight', 'bold')
                .text('Sentiment (-1 = Negative, 0 = Neutral, +1 = Positive)');
            
            // Quadrant lines
            svg.append('line')
                .attr('x1', 0).attr('x2', width)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .style('stroke', 'gray')
                .style('stroke-dasharray', '5,5')
                .style('stroke-width', 2);
            
            svg.append('line')
                .attr('x1', xScale(0.5)).attr('x2', xScale(0.5))
                .attr('y1', 0).attr('y2', height)
                .style('stroke', 'gray')
                .style('stroke-dasharray', '5,5')
                .style('stroke-width', 2);
            
            // Annotations
            const annotations = [
                {x: 0.95, y: -0.85, text: 'Angry Fan', bg: 'lightcoral'},
                {x: 0.95, y: 0.85, text: 'Superfan', bg: 'lightgreen'},
                {x: 0.05, y: -0.05, text: 'Analyst', bg: 'lightblue'}
            ];
            
            annotations.forEach(ann => {
                svg.append('rect')
                    .attr('x', xScale(ann.x) - 40)
                    .attr('y', yScale(ann.y) - 15)
                    .attr('width', 80)
                    .attr('height', 25)
                    .attr('rx', 5)
                    .style('fill', ann.bg)
                    .style('opacity', 0.7);
                
                svg.append('text')
                    .attr('x', xScale(ann.x))
                    .attr('y', yScale(ann.y))
                    .attr('text-anchor', 'middle')
                    .attr('dy', '0.35em')
                    .text(ann.text)
                    .style('font-size', '12px')
                    .style('font-weight', 'bold');
            });
            
            // Plot points
            svg.selectAll('.dot')
                .data(processedData)
                .enter().append('circle')
                .attr('class', 'dot')
                .attr('cx', d => xScale(d.subjectivity))
                .attr('cy', d => yScale(d.sentiment))
                .attr('r', 5)
                .style('fill', d => colorScale(d.sport))
                .style('opacity', 0.6)
                .style('stroke', 'black')
                .style('stroke-width', 0.5)
                .on('mouseover', function(event, d) {
                    d3.select(this).attr('r', 8).style('opacity', 1);
                    tooltip.style('opacity', 1)
                        .html(`Sport: ${d.sport}<br/>Sentiment: ${d.sentiment.toFixed(2)}<br/>Subjectivity: ${d.subjectivity.toFixed(2)}`);
                })
                .on('mousemove', function(event) {
                    tooltip.style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 10) + 'px');
                })
                .on('mouseout', function() {
                    d3.select(this).attr('r', 5).style('opacity', 0.6);
                    tooltip.style('opacity', 0);
                });
            
            // Legend
            const sports = [...new Set(data.map(d => d.Matched_Keyword))];
            const legend = svg.append('g')
                .attr('transform', `translate(${width + 20}, 0)`);
            
            legend.append('text')
                .attr('x', 0)
                .attr('y', -10)
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .text('Sports:');
            
            sports.forEach((sport, i) => {
                const legendRow = legend.append('g')
                    .attr('transform', `translate(0, ${i * 25 + 10})`);
                
                legendRow.append('circle')
                    .attr('r', 6)
                    .style('fill', colorScale(sport))
                    .style('opacity', 0.6)
                    .style('stroke', 'black')
                    .style('stroke-width', 0.5);
                
                legendRow.append('text')
                    .attr('x', 15)
                    .attr('y', 5)
                    .text(sport)
                    .style('font-size', '12px');
            });
            
            // Add data count annotation
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', -20)
                .attr('text-anchor', 'middle')
                .style('font-size', '12px')
                .style('fill', '#7f8c8d')
                .text(`Total Data Points: ${processedData.length}`);
        });
    </script>
</body>
</html>
